(self.webpackChunkwn_builder=self.webpackChunkwn_builder||[]).push([[975],{13:(t,e,o)=>{o(60),o(37),o(463),o(321),o(405),o(762),o(681),o(414),o(320),o(117),o(683),o(755),o(777),o(38),o(203),o(702)},60:()=>{!function(t){"use strict";void 0===t.wn.builder&&(t.wn.builder={});var e=t.wn.foundation.base,o=(e.prototype,function(){this.data={},this.requestCache={},this.callbackCache={},e.call(this)});o.prototype.set=function(t,e,o,n,i){this.storeData(t,e,o,n),"localization"!=e||o||this.localizationUpdated(t,i)},o.prototype.get=function(t,e,o,n,i){if(void 0===this.data[e]||void 0===this.data[e][o]||void 0===this.data[e][o][n]||this.isCacheObsolete(this.data[e][o][n].timestamp))return this.loadDataFromServer(t,e,o,n,i);i(this.data[e][o][n].data)},o.prototype.makeCacheKey=function(t,e,o){var n=t+"-"+e;return o&&(n+="-"+o),n},o.prototype.isCacheObsolete=function(t){return Date.now()-t>3e5},o.prototype.loadDataFromServer=function(t,e,o,n,i){var r=this,a=this.makeCacheKey(e,o,n);return void 0===this.requestCache[a]&&(this.requestCache[a]=t.request("onPluginDataRegistryGetData",{data:{registry_plugin_code:e,registry_data_type:o,registry_data_subtype:n}}).done((function(t){if(void 0===t.registryData)throw new Error("Invalid data registry response.");r.storeData(e,o,n,t.registryData),r.applyCallbacks(a,t.registryData),r.requestCache[a]=void 0}))),this.addCallbackToQueue(i,a),this.requestCache[a]},o.prototype.addCallbackToQueue=function(t,e){void 0===this.callbackCache[e]&&(this.callbackCache[e]=[]),this.callbackCache[e].push(t)},o.prototype.applyCallbacks=function(t,e){if(void 0!==this.callbackCache[t]){for(var o=this.callbackCache[t].length-1;o>=0;o--)this.callbackCache[t][o](e);delete this.callbackCache[t]}},o.prototype.storeData=function(t,e,o,n){void 0===this.data[t]&&(this.data[t]={}),void 0===this.data[t][e]&&(this.data[t][e]={});var i={timestamp:Date.now(),data:n};this.data[t][e][o]=i},o.prototype.clearCache=function(t,e){void 0!==this.data[t]&&void 0!==this.data[t][e]&&(this.data[t][e]=void 0)},o.prototype.getLocalizationString=function(t,e,o,n){this.get(t,e,"localization",null,(function(t){void 0===t[o]?n(o):n(t[o])}))},o.prototype.localizationUpdated=function(e,o){t.wn.builder.localizationInput.updatePluginInputs(e),void 0!==o&&o.suppressLanguageEditorUpdate||t.wn.builder.indexController.entityControllers.localization.languageUpdated(e),t.wn.builder.indexController.entityControllers.localization.updateOnScreenStrings(e)},t.wn.builder.dataRegistry=new o}(window.jQuery)},37:()=>{!function(t){"use strict";void 0===t.wn.builder&&(t.wn.builder={}),void 0===t.wn.builder.entityControllers&&(t.wn.builder.entityControllers={});var e=t.wn.foundation.base,o=e.prototype,n=function(t,o){if(void 0===t)throw new Error("The Builder entity type name should be set in the base constructor call.");if(void 0===o)throw new Error("The Builder index controller should be set when creating an entity controller.");this.typeName=t,this.indexController=o,e.call(this)};(n.prototype=Object.create(o)).constructor=n,n.prototype.registerHandlers=function(){},n.prototype.invokeCommand=function(t,e){if(!/^cmd[a-zA-Z0-9]+$/.test(t))throw new Error("Invalid command: "+t);if(void 0===this[t])throw new Error("Unknown command: "+t);this[t].apply(this,[e])},n.prototype.newTabId=function(){return this.typeName+Math.random()},n.prototype.makeTabId=function(t){return this.typeName+"-"+t},n.prototype.getMasterTabsActivePane=function(){return this.indexController.getMasterTabActivePane()},n.prototype.getMasterTabsObject=function(){return this.indexController.masterTabsObj},n.prototype.getSelectedPlugin=function(){return t("#PluginList-pluginList-plugin-list > ul > li.active").data("id")},n.prototype.getIndexController=function(){return this.indexController},n.prototype.updateMasterTabIdAndTitle=function(t,e){var o=this.getMasterTabsObject();o.updateIdentifier(t,e.tabId),o.updateTitle(t,e.tabTitle)},n.prototype.unhideFormDeleteButton=function(e){t("[data-control=delete-button]",e).removeClass("hide")},n.prototype.forceCloseTab=function(t){t.trigger("close.oc.tab",[{force:!0}])},n.prototype.unmodifyTab=function(t){this.indexController.unchangeTab(t)},t.wn.builder.entityControllers.base=n}(window.jQuery)},755:()=>{!function(t){"use strict";void 0===t.wn.builder&&(t.wn.builder={}),void 0===t.wn.builder.entityControllers&&(t.wn.builder.entityControllers={});var e=t.wn.builder.entityControllers.base,o=e.prototype,n=function(t){e.call(this,"controller",t)};(n.prototype=Object.create(o)).constructor=n,n.prototype.cmdCreateController=function(e){var o=t(e.currentTarget),n=this,i=o.data("pluginCode");(o.find('input[name="behaviors[]"]:checked').length?this.indexController.openOrLoadMasterTab(o,"onControllerCreate",this.makeTabId(i+"-new-controller"),{}):o.request("onControllerCreate")).done((function(t){o.trigger("close.oc.popup"),n.updateDataRegistry(t)})).always(t.wn.builder.indexController.hideStripeIndicatorProxy)},n.prototype.cmdOpenController=function(e){var o=t(e.currentTarget).data("id"),n=t(e.currentTarget).data("pluginCode");this.indexController.openOrLoadMasterTab(t(e.target),"onControllerOpen",this.makeTabId(n+"-"+o),{controller:o})},n.prototype.cmdSaveController=function(e){var o=t(e.currentTarget),n=o.closest("form").find(".inspector-container");t.wn.inspector.manager.applyValuesFromContainer(n)&&o.request("onControllerSave").done(this.proxy(this.saveControllerDone))},n.prototype.saveControllerDone=function(t){if(void 0===t.builderResponseData)throw new Error("Invalid response data");var e=this.getMasterTabsActivePane();this.getIndexController().unchangeTab(e)},n.prototype.updateDataRegistry=function(e){if(void 0!==e.builderResponseData.registryData){var o=e.builderResponseData.registryData;t.wn.builder.dataRegistry.set(o.pluginCode,"controller-urls",null,o.urls)}},n.prototype.getControllerList=function(){return t("#layout-side-panel form[data-content-id=controller] [data-control=filelist]")},t.wn.builder.entityControllers.controller=n}(window.jQuery)},321:()=>{!function(t){"use strict";void 0===t.wn.builder&&(t.wn.builder={}),void 0===t.wn.builder.entityControllers&&(t.wn.builder.entityControllers={});var e=t.wn.builder.entityControllers.base,o=e.prototype,n=function(t){e.call(this,"databaseTable",t)};(n.prototype=Object.create(o)).constructor=n,n.prototype.cmdCreateTable=function(e){var o=this.indexController.openOrLoadMasterTab(t(e.target),"onDatabaseTableCreateOrOpen",this.newTabId());!1!==o&&o.done(this.proxy(this.onTableLoaded,this))},n.prototype.cmdOpenTable=function(e){var o=t(e.currentTarget).data("id"),n=this.indexController.openOrLoadMasterTab(t(e.target),"onDatabaseTableCreateOrOpen",this.makeTabId(o),{table_name:o});!1!==n&&n.done(this.proxy(this.onTableLoaded,this))},n.prototype.cmdSaveTable=function(e){var o=t(e.currentTarget);if(this.validateTable(o)){var n={columns:this.getTableData(o)};o.popup({extraData:n,handler:"onDatabaseTableValidateAndShowPopup"})}},n.prototype.cmdSaveMigration=function(e){var o=t(e.currentTarget);t.wn.stripeLoadIndicator.show(),o.request("onDatabaseTableMigrationApply").always(t.wn.builder.indexController.hideStripeIndicatorProxy).done(this.proxy(this.saveMigrationDone))},n.prototype.cmdDeleteTable=function(e){var o=t(e.currentTarget);t.wn.confirm(o.data("confirm"),this.proxy(this.deleteConfirmed))},n.prototype.cmdUnModifyForm=function(){var t=this.getMasterTabsActivePane();this.unmodifyTab(t)},n.prototype.cmdAddIdColumn=function(e){var o=t(e.currentTarget);this.addIdColumn(o)||alert(o.closest("form").attr("data-lang-id-exists"))},n.prototype.cmdAddTimestamps=function(e){var o=t(e.currentTarget);this.addTimeStampColumns(o,["created_at","updated_at"])||alert(o.closest("form").attr("data-lang-timestamps-exist"))},n.prototype.cmdAddSoftDelete=function(e){var o=t(e.currentTarget);this.addTimeStampColumns(o,["deleted_at"])||alert(o.closest("form").attr("data-lang-soft-deleting-exist"))},n.prototype.onTableCellChanged=function(e,o,n,i){var r=t(e.target);if("columns"==r.data("alias")&&"database"==r.closest("form").data("entity")){var a={};"auto_increment"==o&&n&&(a.unsigned=1,a.primary_key=1),"unsigned"!=o||n||(a.auto_increment=0),"primary_key"==o&&n&&(a.allow_null=0),"allow_null"==o&&n&&(a.primary_key=0),"primary_key"!=o||n||(a.auto_increment=0),r.table("setRowValues",i,a)}},n.prototype.onTableLoaded=function(){t(document).trigger("render");var e=this.getMasterTabsActivePane(),o=e.find("form"),n=e.find("div[data-control=table] div.toolbar"),i=t('<a class="btn wn-icon-hashtag builder-custom-table-button" data-builder-command="databaseTable:cmdAddIdColumn"></a>'),r=t('<a class="btn wn-icon-clock-o builder-custom-table-button" data-builder-command="databaseTable:cmdAddTimestamps"></a>'),a=t('<a class="btn wn-icon-refresh builder-custom-table-button" data-builder-command="databaseTable:cmdAddSoftDelete"></a>');i.text(o.attr("data-lang-add-id")),n.append(i),r.text(o.attr("data-lang-add-timestamps")),n.append(r),a.text(o.attr("data-lang-add-soft-delete")),n.append(a)},n.prototype.registerHandlers=function(){this.indexController.$masterTabs.on("oc.tableCellChanged",this.proxy(this.onTableCellChanged))},n.prototype.validateTable=function(t){var e=this.getTableControlObject(t);return e.unfocusTable(),e.validate()},n.prototype.getTableData=function(t){return this.getTableControlObject(t).dataSource.getAllData()},n.prototype.getTableControlObject=function(t){var e=t.closest("form").find("[data-control=table]").data("oc.table");if(!e)throw new Error("Table object is not found on the database table tab");return e},n.prototype.saveMigrationDone=function(e){if(void 0===e.builderResponseData)throw new Error("Invalid response data");t("#builderTableMigrationPopup").trigger("close.oc.popup");var o=this.getMasterTabsActivePane();this.getMasterTabsObject();"delete"!=e.builderResponseData.operation?(o.find("input[name=table_name]").val(e.builderResponseData.builderObjectName),this.updateMasterTabIdAndTitle(o,e.builderResponseData),this.unhideFormDeleteButton(o),this.getTableList().fileList("markActive",e.builderResponseData.tabId),this.getIndexController().unchangeTab(o),this.updateTable(e.builderResponseData)):this.forceCloseTab(o),t.wn.builder.dataRegistry.clearCache(e.builderResponseData.pluginCode,"model-columns")},n.prototype.getTableList=function(){return t("#layout-side-panel form[data-content-id=database] [data-control=filelist]")},n.prototype.deleteConfirmed=function(){this.getMasterTabsActivePane().find("form").popup({handler:"onDatabaseTableShowDeletePopup"})},n.prototype.getColumnNames=function(e){this.getTableControlObject(e).unfocusTable();var o=this.getTableData(e),n=[];for(var i in o)void 0!==o[i].name&&n.push(t.trim(o[i].name));return n},n.prototype.addIdColumn=function(t){var e=!1;if(-1===this.getColumnNames(t).indexOf("id")){var o=this.getTableControlObject(t),n=this.getTableData(t);(n.length-1||n[0].name||n[0].type||n[0].length||n[0].unsigned||n[0].nullable||n[0].auto_increment||n[0].primary_key||n[0].default)&&o.addRecord("bottom",!0),o.setRowValues(n.length-1,{name:"id",type:"integer",unsigned:!0,auto_increment:!0,primary_key:!0}),o.addRecord("bottom",!1),o.deleteRecord(),e=!0}return e&&t.trigger("change"),e},n.prototype.addTimeStampColumns=function(t,e){var o=this.getColumnNames(t),n=!1;for(var i in e){var r=e[i];-1===o.indexOf(r)&&(this.addTimeStampColumn(t,r),n=!0)}return n&&t.trigger("change"),n},n.prototype.addTimeStampColumn=function(t,e){var o=this.getTableControlObject(t),n=this.getTableData(t),i={name:e,type:"timestamp",default:null,allow_null:!0};o.addRecord("bottom",!0),o.setRowValues(n.length-1,i),o.addRecord("bottom",!1),o.deleteRecord()},n.prototype.updateTable=function(e){var o=this.getMasterTabsObject(),n=t("#builder-master-tabs").data("oc.tab").findByIdentifier(e.tabId);o.updateTab(n,e.tableName,e.tab),this.onTableLoaded()},t.wn.builder.entityControllers.databaseTable=n}(window.jQuery)},683:()=>{!function(t){"use strict";void 0===t.wn.builder&&(t.wn.builder={}),void 0===t.wn.builder.entityControllers&&(t.wn.builder.entityControllers={});var e=t.wn.builder.entityControllers.base,o=e.prototype,n=function(t){e.call(this,"localization",t)};(n.prototype=Object.create(o)).constructor=n,n.prototype.cmdCreateLanguage=function(e){this.indexController.openOrLoadMasterTab(t(e.target),"onLanguageCreateOrOpen",this.newTabId())},n.prototype.cmdOpenLanguage=function(e){var o=t(e.currentTarget).data("id"),n=t(e.currentTarget).data("pluginCode");this.indexController.openOrLoadMasterTab(t(e.target),"onLanguageCreateOrOpen",this.makeTabId(n+"-"+o),{original_language:o})},n.prototype.cmdSaveLanguage=function(e){var o=t(e.currentTarget);o.closest("form");o.request("onLanguageSave").done(this.proxy(this.saveLanguageDone))},n.prototype.cmdDeleteLanguage=function(e){var o=t(e.currentTarget);t.wn.confirm(o.data("confirm"),this.proxy(this.deleteConfirmed))},n.prototype.cmdCopyMissingStrings=function(e){var o=t(e.currentTarget),n=o.find("select[name=language]").val(),i=this.getMasterTabsActivePane();o.trigger("close.oc.popup"),t.wn.stripeLoadIndicator.show(),i.find("form").request("onLanguageCopyStringsFrom",{data:{copy_from:n}}).always(t.wn.builder.indexController.hideStripeIndicatorProxy).done(this.proxy(this.copyStringsFromDone))},n.prototype.languageUpdated=function(e){var o=this.findDefaultLanguageForm(e);if(o){var n=t(o);n.hasClass("oc-data-changed")?this.mergeLanguageFromServer(n):this.updateLanguageFromServer(n)}},n.prototype.updateOnScreenStrings=function(e){var o=document.body.querySelectorAll('span[data-localization-key][data-plugin="'+e+'"]');t.wn.builder.dataRegistry.get(t("#builder-plugin-selector-panel form"),e,"localization",null,(function(t){for(var e=o.length-1;e>=0;e--){var n=o[e],i=n.getAttribute("data-localization-key");void 0!==t[i]?n.textContent=t[i]:n.textContent=i}}))},n.prototype.saveLanguageDone=function(e){if(void 0===e.builderResponseData)throw new Error("Invalid response data");var o=this.getMasterTabsActivePane();if(o.find("input[name=original_language]").val(e.builderResponseData.language),this.updateMasterTabIdAndTitle(o,e.builderResponseData),this.unhideFormDeleteButton(o),this.getLanguageList().fileList("markActive",e.builderResponseData.tabId),this.getIndexController().unchangeTab(o),void 0!==e.builderResponseData.registryData){var n=e.builderResponseData.registryData;t.wn.builder.dataRegistry.set(n.pluginCode,"localization",null,n.strings,{suppressLanguageEditorUpdate:!0}),t.wn.builder.dataRegistry.set(n.pluginCode,"localization","sections",n.sections)}},n.prototype.getLanguageList=function(){return t("#layout-side-panel form[data-content-id=localization] [data-control=filelist]")},n.prototype.getCodeEditor=function(t){return t.find("div[data-field-name=strings] div[data-control=codeeditor]").data("oc.codeEditor").editor},n.prototype.deleteConfirmed=function(){var e=this.getMasterTabsActivePane().find("form");t.wn.stripeLoadIndicator.show(),e.request("onLanguageDelete").always(t.wn.builder.indexController.hideStripeIndicatorProxy).done(this.proxy(this.deleteDone))},n.prototype.deleteDone=function(){var t=this.getMasterTabsActivePane();this.getIndexController().unchangeTab(t),this.forceCloseTab(t)},n.prototype.copyStringsFromDone=function(e){if(void 0===e.builderResponseData)throw new Error("Invalid response data");var o=e.builderResponseData,n=this.getMasterTabsActivePane(),i=n.find("form"),r=this.getCodeEditor(n),a=i.data("newStringMessage"),s=i.data("structureMismatch");r.getSession().setValue(o.strings);for(var l=[],d=o.updatedLines.length-1;d>=0;d--){var p=o.updatedLines[d];l.push({row:p,column:0,text:a,type:"warning"})}r.getSession().setAnnotations(l),o.mismatch&&t.wn.alert(s)},n.prototype.findDefaultLanguageForm=function(t){for(var e=document.body.querySelectorAll("form[data-entity=localization]"),o=e.length-1;o>=0;o--){var n=e[o],i=n.querySelector("input[name=plugin_code]"),r=n.querySelector("input[name=original_language]");if(i&&i.value==t&&(r&&n.getAttribute("data-default-language")==r.value))return n}return null},n.prototype.updateLanguageFromServer=function(t){var e=this;t.request("onLanguageGetStrings").done((function(o){e.updateLanguageFromServerDone(t,o)}))},n.prototype.updateLanguageFromServerDone=function(t,e){if(void 0===e.builderResponseData)throw new Error("Invalid response data");var o=e.builderResponseData,n=t.closest(".tab-pane"),i=this.getCodeEditor(n);o.strings&&(i.getSession().setValue(o.strings),this.unmodifyTab(n))},n.prototype.mergeLanguageFromServer=function(t){var e=t.find("input[name=original_language]").val(),o=this;t.request("onLanguageCopyStringsFrom",{data:{copy_from:e}}).done((function(e){o.mergeLanguageFromServerDone(t,e)}))},n.prototype.mergeLanguageFromServerDone=function(t,e){if(void 0===e.builderResponseData)throw new Error("Invalid response data");var o=e.builderResponseData,n=t.closest(".tab-pane"),i=this.getCodeEditor(n);i.getSession().setValue(o.strings),i.getSession().setAnnotations([])},t.wn.builder.entityControllers.localization=n}(window.jQuery)},320:()=>{!function(t){"use strict";void 0===t.wn.builder&&(t.wn.builder={}),void 0===t.wn.builder.entityControllers&&(t.wn.builder.entityControllers={});var e=t.wn.builder.entityControllers.base,o=e.prototype,n=function(t){e.call(this,"menus",t)};(n.prototype=Object.create(o)).constructor=n,n.prototype.cmdOpenMenus=function(e){var o=this.getSelectedPlugin();o?this.indexController.openOrLoadMasterTab(t(e.target),"onMenusOpen",this.makeTabId(o)):alert("Please select a plugin first")},n.prototype.cmdSaveMenus=function(e){var o=t(e.currentTarget),n=o.closest("form"),i=n.find(".inspector-container");if(t.wn.inspector.manager.applyValuesFromContainer(i)){var r=t.wn.builder.menubuilder.controller.getJson(n.get(0));o.request("onMenusSave",{data:{menus:r}}).done(this.proxy(this.saveMenusDone))}},n.prototype.cmdAddMainMenuItem=function(e){t.wn.builder.menubuilder.controller.addMainMenuItem(e)},n.prototype.cmdAddSideMenuItem=function(e){t.wn.builder.menubuilder.controller.addSideMenuItem(e)},n.prototype.cmdDeleteMenuItem=function(e){t.wn.builder.menubuilder.controller.deleteMenuItem(e)},n.prototype.saveMenusDone=function(t){if(void 0===t.builderResponseData)throw new Error("Invalid response data");var e=this.getMasterTabsActivePane();this.getIndexController().unchangeTab(e)},t.wn.builder.entityControllers.menus=n}(window.jQuery)},405:()=>{!function(t){"use strict";void 0===t.wn.builder&&(t.wn.builder={}),void 0===t.wn.builder.entityControllers&&(t.wn.builder.entityControllers={});var e=t.wn.builder.entityControllers.base,o=e.prototype,n=function(t){e.call(this,"model",t)};(n.prototype=Object.create(o)).constructor=n,n.prototype.cmdCreateModel=function(e){var o=t(e.currentTarget);o.one("shown.oc.popup",this.proxy(this.onModelPopupShown)),o.popup({handler:"onModelLoadPopup"})},n.prototype.cmdDeleteModel=function(e){var o=t(e.currentTarget),n=o.data("modelClass");t.wn.confirm(o.data("confirm"),(function(){t.request("onModelDelete",{data:{model:n},flash:!0})}))},n.prototype.cmdApplyModelSettings=function(e){var o=t(e.currentTarget),n=this;t.wn.stripeLoadIndicator.show(),o.request("onModelSave").always(t.wn.builder.indexController.hideStripeIndicatorProxy).done((function(t){o.trigger("close.oc.popup"),n.applyModelSettingsDone(t)}))},n.prototype.onModelPopupShown=function(e,o,n){t(n).find("input[name=className]").focus()},n.prototype.applyModelSettingsDone=function(e){if(void 0!==e.builderResponseData.registryData){var o=e.builderResponseData.registryData;t.wn.builder.dataRegistry.set(o.pluginCode,"model-classes",null,o.models)}},t.wn.builder.entityControllers.model=n}(window.jQuery)},762:()=>{!function(t){"use strict";void 0===t.wn.builder&&(t.wn.builder={}),void 0===t.wn.builder.entityControllers&&(t.wn.builder.entityControllers={});var e=t.wn.builder.entityControllers.base,o=e.prototype,n=function(t){e.call(this,"modelForm",t)};(n.prototype=Object.create(o)).constructor=n,n.prototype.cmdCreateForm=function(e){var o=t(e.currentTarget),n={model_class:o.data("modelClass")};this.indexController.openOrLoadMasterTab(o,"onModelFormCreateOrOpen",this.newTabId(),n)},n.prototype.cmdSaveForm=function(e){var o=t(e.currentTarget),n=o.closest("form"),i=t("[data-root-control-wrapper] > [data-control-container]",n),r=n.find(".inspector-container"),a=t.wn.builder.formbuilder.domToPropertyJson.convert(i.get(0));if(t.wn.inspector.manager.applyValuesFromContainer(r))if(!1!==a){var s={controls:a};o.request("onModelFormSave",{data:s}).done(this.proxy(this.saveFormDone))}else t.wn.flashMsg({text:t.wn.builder.formbuilder.domToPropertyJson.getLastError(),class:"error",interval:5})},n.prototype.cmdAddDatabaseFields=function(e){var o=t(e.currentTarget),n=this.getMasterTabsActivePane().find(".builder-control-list .control.placeholder:first")[0],i=o.find(".control-table").data("oc.table").dataSource.data.filter((function(t){return t.add})).reverse();o.closest(".control-popup").data("oc.popup").hide(),t.wn.stripeLoadIndicator.show();var r=t.when({});t.each(i,(function(e,o){r=r.then(function(e){return function(){var o=t.Deferred();return t.wn.builder.formbuilder.controller.addControlToPlaceholder(n,e.type,e.label?e.label:e.column,!1,e.column).complete((function(){o.resolve()})),o.promise()}}(o))})),t.when(r).always(t.wn.builder.indexController.hideStripeIndicatorProxy)},n.prototype.cmdOpenForm=function(e){var o=t(e.currentTarget).data("form"),n=t(e.currentTarget).data("modelClass");this.indexController.openOrLoadMasterTab(t(e.target),"onModelFormCreateOrOpen",this.makeTabId(n+"-"+o),{file_name:o,model_class:n})},n.prototype.cmdDeleteForm=function(e){var o=t(e.currentTarget);t.wn.confirm(o.data("confirm"),this.proxy(this.deleteConfirmed))},n.prototype.cmdAddControl=function(e){t.wn.builder.formbuilder.controlPalette.addControl(e)},n.prototype.cmdUndockControlPalette=function(e){t.wn.builder.formbuilder.controlPalette.undockFromContainer(e)},n.prototype.cmdDockControlPalette=function(e){t.wn.builder.formbuilder.controlPalette.dockToContainer(e)},n.prototype.cmdCloseControlPalette=function(e){t.wn.builder.formbuilder.controlPalette.closeInContainer(e)},n.prototype.saveFormDone=function(t){if(void 0===t.builderResponseData)throw new Error("Invalid response data");var e=this.getMasterTabsActivePane();e.find("input[name=file_name]").val(t.builderResponseData.builderObjectName),this.updateMasterTabIdAndTitle(e,t.builderResponseData),this.unhideFormDeleteButton(e),this.getModelList().fileList("markActive",t.builderResponseData.tabId),this.getIndexController().unchangeTab(e),this.updateDataRegistry(t)},n.prototype.updateDataRegistry=function(e){if(void 0!==e.builderResponseData.registryData){var o=e.builderResponseData.registryData;t.wn.builder.dataRegistry.set(o.pluginCode,"model-forms",o.modelClass,o.forms)}},n.prototype.deleteConfirmed=function(){var e=this.getMasterTabsActivePane().find("form");t.wn.stripeLoadIndicator.show(),e.request("onModelFormDelete").always(t.wn.builder.indexController.hideStripeIndicatorProxy).done(this.proxy(this.deleteDone))},n.prototype.deleteDone=function(t){var e=this.getMasterTabsActivePane();this.getIndexController().unchangeTab(e),this.forceCloseTab(e),this.updateDataRegistry(t)},n.prototype.getModelList=function(){return t("#layout-side-panel form[data-content-id=models] [data-control=filelist]")},t.wn.builder.entityControllers.modelForm=n}(window.jQuery)},681:()=>{!function(t){"use strict";void 0===t.wn.builder&&(t.wn.builder={}),void 0===t.wn.builder.entityControllers&&(t.wn.builder.entityControllers={});var e=t.wn.builder.entityControllers.base,o=e.prototype,n=function(t){this.cachedModelFieldsPromises={},e.call(this,"modelList",t)};(n.prototype=Object.create(o)).constructor=n,n.prototype.registerHandlers=function(){t(document).on("autocompleteitems.oc.table",'form[data-sub-entity="model-list"] [data-control=table]',this.proxy(this.onAutocompleteItems))},n.prototype.cmdCreateList=function(e){var o=t(e.currentTarget),n={model_class:o.data("modelClass")},i=this.indexController.openOrLoadMasterTab(o,"onModelListCreateOrOpen",this.newTabId(),n);!1!==i&&i.done(this.proxy(this.onListLoaded,this))},n.prototype.cmdSaveList=function(e){var o=t(e.currentTarget);o.closest("form");this.validateTable(o)&&o.request("onModelListSave",{data:{columns:this.getTableData(o)}}).done(this.proxy(this.saveListDone))},n.prototype.cmdOpenList=function(e){var o=t(e.currentTarget).data("list"),n=t(e.currentTarget).data("modelClass"),i=this.indexController.openOrLoadMasterTab(t(e.target),"onModelListCreateOrOpen",this.makeTabId(n+"-"+o),{file_name:o,model_class:n});!1!==i&&i.done(this.proxy(this.onListLoaded,this))},n.prototype.cmdDeleteList=function(e){var o=t(e.currentTarget);t.wn.confirm(o.data("confirm"),this.proxy(this.deleteConfirmed))},n.prototype.cmdAddDatabaseColumns=function(e){var o=t(e.currentTarget);t.wn.stripeLoadIndicator.show(),o.request("onModelListLoadDatabaseColumns").done(this.proxy(this.databaseColumnsLoaded)).always(t.wn.builder.indexController.hideStripeIndicatorProxy)},n.prototype.saveListDone=function(t){if(void 0===t.builderResponseData)throw new Error("Invalid response data");var e=this.getMasterTabsActivePane();e.find("input[name=file_name]").val(t.builderResponseData.builderObjectName),this.updateMasterTabIdAndTitle(e,t.builderResponseData),this.unhideFormDeleteButton(e),this.getModelList().fileList("markActive",t.builderResponseData.tabId),this.getIndexController().unchangeTab(e),this.updateDataRegistry(t)},n.prototype.deleteConfirmed=function(){var e=this.getMasterTabsActivePane().find("form");t.wn.stripeLoadIndicator.show(),e.request("onModelListDelete").always(t.wn.builder.indexController.hideStripeIndicatorProxy).done(this.proxy(this.deleteDone))},n.prototype.deleteDone=function(t){var e=this.getMasterTabsActivePane();this.getIndexController().unchangeTab(e),this.forceCloseTab(e),this.updateDataRegistry(t)},n.prototype.getTableControlObject=function(t){var e=t.closest("form").find("[data-control=table]").data("oc.table");if(!e)throw new Error("Table object is not found on the model list tab");return e},n.prototype.getModelList=function(){return t("#layout-side-panel form[data-content-id=models] [data-control=filelist]")},n.prototype.validateTable=function(t){var e=this.getTableControlObject(t);return e.unfocusTable(),e.validate()},n.prototype.getTableData=function(t){return this.getTableControlObject(t).dataSource.getAllData()},n.prototype.loadModelFields=function(e,o){var n=t(e).closest("form"),i=n.find("input[name=model_class]").val(),r=n.data("oc.model-field-cache");void 0===r?(void 0===this.cachedModelFieldsPromises[i]&&(this.cachedModelFieldsPromises[i]=n.request("onModelFormGetModelFields",{data:{as_plain_list:1}})),void 0!==o&&this.cachedModelFieldsPromises[i].done((function(t){n.data("oc.model-field-cache",t.responseData.options),o(t.responseData.options)}))):o(r)},n.prototype.updateDataRegistry=function(e){if(void 0!==e.builderResponseData.registryData){var o=e.builderResponseData.registryData;t.wn.builder.dataRegistry.set(o.pluginCode,"model-lists",o.modelClass,o.lists),t.wn.builder.dataRegistry.clearCache(o.pluginCode,"plugin-lists")}},n.prototype.databaseColumnsLoaded=function(e){t.isArray(e.responseData.columns)||alert("Invalid server response");var o=this.getMasterTabsActivePane().find("form"),n=this.getColumnNames(o),i=!1;for(var r in e.responseData.columns){var a=e.responseData.columns[r],s=this.mapType(a.type);-1===t.inArray(a.name,n)&&(this.addColumn(o,a.name,s),i=!0)}i?o.trigger("change"):alert(o.attr("data-lang-all-database-columns-exist"))},n.prototype.mapType=function(t){switch(t){case"integer":return"number";case"timestamp":return"datetime";default:return"text"}},n.prototype.addColumn=function(t,e,o){var n=this.getTableControlObject(t),i=this.getTableData(t),r={field:e,label:e,type:o};n.addRecord("bottom",!0),n.setRowValues(i.length-1,r),n.addRecord("bottom",!1),n.deleteRecord()},n.prototype.getColumnNames=function(e){this.getTableControlObject(e).unfocusTable();var o=this.getTableData(e),n=[];for(var i in o)void 0!==o[i].field&&n.push(t.trim(o[i].field));return n},n.prototype.onAutocompleteItems=function(t,e){if("model-fields"===e.columnConfiguration.fillFrom)return t.preventDefault(),this.loadModelFields(t.target,e.callback),!1},n.prototype.onListLoaded=function(){t(document).trigger("render");var e=this.getMasterTabsActivePane(),o=e.find("form"),n=e.find("div[data-control=table] div.toolbar"),i=t('<a class="btn wn-icon-magic builder-custom-table-button" data-builder-command="modelList:cmdAddDatabaseColumns"></a>');i.text(o.attr("data-lang-add-database-columns")),n.append(i)},t.wn.builder.entityControllers.modelList=n}(window.jQuery)},414:()=>{!function(t){"use strict";void 0===t.wn.builder&&(t.wn.builder={}),void 0===t.wn.builder.entityControllers&&(t.wn.builder.entityControllers={});var e=t.wn.builder.entityControllers.base,o=e.prototype,n=function(t){e.call(this,"permissions",t)};(n.prototype=Object.create(o)).constructor=n,n.prototype.registerHandlers=function(){this.indexController.$masterTabs.on("oc.tableNewRow",this.proxy(this.onTableRowCreated))},n.prototype.cmdOpenPermissions=function(e){var o=this.getSelectedPlugin();o?this.indexController.openOrLoadMasterTab(t(e.target),"onPermissionsOpen",this.makeTabId(o)):alert("Please select a plugin first")},n.prototype.cmdSavePermissions=function(e){var o=t(e.currentTarget);o.closest("form");this.validateTable(o)&&o.request("onPermissionsSave",{data:{permissions:this.getTableData(o)}}).done(this.proxy(this.savePermissionsDone))},n.prototype.getTableControlObject=function(t){var e=t.closest("form").find("[data-control=table]").data("oc.table");if(!e)throw new Error("Table object is not found on permissions tab");return e},n.prototype.validateTable=function(t){var e=this.getTableControlObject(t);return e.unfocusTable(),e.validate()},n.prototype.getTableData=function(t){return this.getTableControlObject(t).dataSource.getAllData()},n.prototype.savePermissionsDone=function(e){if(void 0===e.builderResponseData)throw new Error("Invalid response data");var o=this.getMasterTabsActivePane();this.getIndexController().unchangeTab(o),t.wn.builder.dataRegistry.clearCache(e.builderResponseData.pluginCode,"permissions")},n.prototype.onTableRowCreated=function(e,o){var n=t(e.target);if("permissions"==n.data("alias")){var i=n.closest("form");if("permissions"==i.data("entity")){var r=i.find("input[name=plugin_code]").val();o.permission=r.toLowerCase()+"."}}},t.wn.builder.entityControllers.permission=n}(window.jQuery)},463:()=>{!function(t){"use strict";void 0===t.wn.builder&&(t.wn.builder={}),void 0===t.wn.builder.entityControllers&&(t.wn.builder.entityControllers={});var e=t.wn.builder.entityControllers.base,o=e.prototype,n=function(t){e.call(this,"plugin",t),this.popupZIndex=5050};(n.prototype=Object.create(o)).constructor=n,n.prototype.cmdMakePluginActive=function(e){var o=t(e.currentTarget).data("pluginCode");this.makePluginActive(o)},n.prototype.cmdCreatePlugin=function(e){var o=t(e.currentTarget);o.one("shown.oc.popup",this.proxy(this.onPluginPopupShown)),o.popup({handler:"onPluginLoadPopup",zIndex:this.popupZIndex})},n.prototype.cmdApplyPluginSettings=function(e){var o=t(e.currentTarget),n=this;t.wn.stripeLoadIndicator.show(),o.request("onPluginSave").always(t.wn.builder.indexController.hideStripeIndicatorProxy).done((function(t){o.trigger("close.oc.popup"),n.applyPluginSettingsDone(t)}))},n.prototype.cmdEditPluginSettings=function(e){var o=t(e.currentTarget);o.one("shown.oc.popup",this.proxy(this.onPluginPopupShown)),o.popup({handler:"onPluginLoadPopup",zIndex:this.popupZIndex,extraData:{pluginCode:o.data("pluginCode")}})},n.prototype.onPluginPopupShown=function(e,o,n){t(n).find("input[name=name]").focus()},n.prototype.applyPluginSettingsDone=function(t){void 0!==t.responseData&&void 0!==t.responseData.isNewPlugin&&this.makePluginActive(t.responseData.pluginCode,!0)},n.prototype.makePluginActive=function(e,o){var n=t("#builder-plugin-selector-panel form").first();t.wn.stripeLoadIndicator.show(),n.request("onPluginSetActive",{data:{pluginCode:e,updatePluginList:o?1:0}}).always(t.wn.builder.indexController.hideStripeIndicatorProxy).done(this.proxy(this.makePluginActiveDone))},n.prototype.makePluginActiveDone=function(e){var o=e.responseData.pluginCode;t("#builder-plugin-selector-panel [data-control=filelist]").fileList("markActive",o),t('[data-control="flyout"]').data("oc.flyout").hide(),t.wn.builder.indexController.hideWelcomeTab()},t.wn.builder.entityControllers.plugin=n}(window.jQuery)},117:()=>{!function(t){"use strict";void 0===t.wn.builder&&(t.wn.builder={}),void 0===t.wn.builder.entityControllers&&(t.wn.builder.entityControllers={});var e=t.wn.builder.entityControllers.base,o=e.prototype,n=function(t){e.call(this,"version",t),this.hiddenHints={}};(n.prototype=Object.create(o)).constructor=n,n.prototype.cmdCreateVersion=function(e){var o=t(e.currentTarget),n=o.data("versionType");this.indexController.openOrLoadMasterTab(o,"onVersionCreateOrOpen",this.newTabId(),{version_type:n})},n.prototype.cmdSaveVersion=function(e){var o=t(e.currentTarget);o.closest("form");o.request("onVersionSave").done(this.proxy(this.saveVersionDone))},n.prototype.cmdOpenVersion=function(e){var o=t(e.currentTarget).data("id"),n=t(e.currentTarget).data("pluginCode");this.indexController.openOrLoadMasterTab(t(e.target),"onVersionCreateOrOpen",this.makeTabId(n+"-"+o),{original_version:o})},n.prototype.cmdDeleteVersion=function(e){var o=t(e.currentTarget);t.wn.confirm(o.data("confirm"),this.proxy(this.deleteConfirmed))},n.prototype.cmdApplyVersion=function(e){var o=t(e.currentTarget),n=o.closest("div.tab-pane"),i=this;this.showHintPopup(n,"builder-version-apply",(function(){o.request("onVersionApply"),t(window).on("ajaxUpdateComplete",(function(t,e,o,n){"onVersionApply"==e.handler&&i.applyVersionDone(o)}))}))},n.prototype.cmdRollbackVersion=function(e){var o=t(e.currentTarget),n=o.closest("div.tab-pane"),i=this;this.showHintPopup(n,"builder-version-rollback",(function(){o.request("onVersionRollback"),t(window).on("ajaxUpdateComplete",(function(t,e,o,n){"onVersionRollback"==e.handler&&i.rollbackVersionDone(o)}))}))},n.prototype.saveVersionDone=function(t){if(void 0===t.builderResponseData)throw new Error("Invalid response data");var e=this.getMasterTabsActivePane();this.updateUiAfterSave(e,t),t.builderResponseData.isApplied||this.showSavedNotAppliedHint(e)},n.prototype.showSavedNotAppliedHint=function(t){this.showHintPopup(t,"builder-version-save-unapplied")},n.prototype.showHintPopup=function(e,o,n){this.getDontShowHintAgain(o,e)?n&&n.apply(this):(e.one("hide.oc.popup",this.proxy(this.onHintPopupHide)),n&&e.one("shown.oc.popup",(function(e,o,i){i.find("form").one("submit",(function(e){return n.apply(this),e.preventDefault(),t(e.target).trigger("close.oc.popup"),!1}))})),e.popup({content:this.getPopupContent(e,o)}))},n.prototype.onHintPopupHide=function(t,e,o){var n=o.find("input[type=checkbox][name=dont_show_again]").is(":checked"),i=o.find("input[type=hidden][name=hint_code]").val();(o.find("form").off("submit"),n)&&(this.getMasterTabsActivePane().find('form[data-entity="versions"]').request("onHideBackendHint",{data:{name:i}}),this.setDontShowHintAgain(i))},n.prototype.setDontShowHintAgain=function(t){this.hiddenHints[t]=!0},n.prototype.getDontShowHintAgain=function(t,e){return void 0!==this.hiddenHints[t]?this.hiddenHints[t]:"true"==e.find('input[type=hidden][data-hint-hidden="'+t+'"]').val()},n.prototype.getPopupContent=function(t,e){var o=t.find('script[data-version-hint-template="'+e+'"]');if(0===o.length)throw new Error("Version popup template not found: "+e);return o.html()},n.prototype.updateUiAfterSave=function(t,e){t.find("input[name=original_version]").val(e.builderResponseData.savedVersion),this.updateMasterTabIdAndTitle(t,e.builderResponseData),this.unhideFormDeleteButton(t),this.getVersionList().fileList("markActive",e.builderResponseData.tabId),this.getIndexController().unchangeTab(t)},n.prototype.deleteConfirmed=function(){var e=this.getMasterTabsActivePane().find("form");t.wn.stripeLoadIndicator.show(),e.request("onVersionDelete").always(t.wn.builder.indexController.hideStripeIndicatorProxy).done(this.proxy(this.deleteDone))},n.prototype.deleteDone=function(){var t=this.getMasterTabsActivePane();this.getIndexController().unchangeTab(t),this.forceCloseTab(t)},n.prototype.applyVersionDone=function(t){if(void 0===t.builderResponseData)throw new Error("Invalid response data");var e=this.getMasterTabsActivePane();this.updateUiAfterSave(e,t),this.updateVersionsButtons()},n.prototype.rollbackVersionDone=function(t){if(void 0===t.builderResponseData)throw new Error("Invalid response data");var e=this.getMasterTabsActivePane();this.updateUiAfterSave(e,t),this.updateVersionsButtons()},n.prototype.getVersionList=function(){return t("#layout-side-panel form[data-content-id=version] [data-control=filelist]")},n.prototype.updateVersionsButtons=function(){for(var e=this.getMasterTabsObject(),o=e.$tabsContainer.find("> li"),n=this.getVersionList(),i=o.length-1;i>=0;i--){var r=t(o[i]),a=r.data("tabId");if(a&&0!=String(a).length){var s=n.find('li[data-id="'+a+'"]');if(s.length){var l=s.data("applied"),d=e.findPaneFromTab(r);l?(d.find('[data-builder-command="version:cmdApplyVersion"]').addClass("hide"),d.find('[data-builder-command="version:cmdRollbackVersion"]').removeClass("hide")):(d.find('[data-builder-command="version:cmdApplyVersion"]').removeClass("hide"),d.find('[data-builder-command="version:cmdRollbackVersion"]').addClass("hide"))}}}},t.wn.builder.entityControllers.version=n}(window.jQuery)},777:()=>{!function(t){"use strict";void 0===t.wn.builder&&(t.wn.builder={});var e=t.wn.foundation.base,o=e.prototype,n=function(){e.call(this),this.$masterTabs=null,this.$welcomeTab=null,this.masterTabsObj=null,this.hideStripeIndicatorProxy=null,this.entityControllers={},this.init()};(n.prototype=Object.create(o)).constructor=n,n.prototype.dispose=function(){o.dispose.call(this)},n.prototype.openOrLoadMasterTab=function(e,o,n,i){if(this.masterTabsObj.goTo(n))return!1;var r=void 0===i?{}:i;return t.wn.stripeLoadIndicator.show(),e.request(o,{data:r}).done(this.proxy(this.addMasterTab)).always(this.hideStripeIndicatorProxy)},n.prototype.getMasterTabActivePane=function(){return this.$masterTabs.find("> .tab-content > .tab-pane.active")},n.prototype.unchangeTab=function(t){t.find("form").trigger("unchange.oc.changeMonitor")},n.prototype.triggerCommand=function(t,e){var o=t.split(":");if(2===o.length){var n=o[0],i=o[1];if(void 0===this.entityControllers[n])throw new Error("Unknown entity type: "+n);this.entityControllers[n].invokeCommand(i,e)}},n.prototype.init=function(){this.$masterTabs=t("#builder-master-tabs"),this.$sidePanel=t("#builder-side-panel"),this.masterTabsObj=this.$masterTabs.data("oc.tab"),this.hideStripeIndicatorProxy=this.proxy(this.hideStripeIndicator),new t.wn.tabFormExpandControls(this.$masterTabs),this.createEntityControllers(),this.registerHandlers(),!1===this.getSelectedPlugin()&&this.addWelcomeTab()},n.prototype.addWelcomeTab=function(){var e=this;t.wn.stripeLoadIndicator.show(),t.request("onWelcome").done((function(o){e.addMasterTab(o),e.$welcomeTab=e.getMasterTabActivePane(),t("button[data-show-plugins]",e.$welcomeTab).click((function(){t('[data-control="flyout"]').data("oc.flyout").show()}))})).always(this.hideStripeIndicatorProxy)},n.prototype.hideWelcomeTab=function(){if(this.$welcomeTab){var t=this.masterTabsObj.findTabFromPane(this.$welcomeTab).parent();console.log(t),this.masterTabsObj.closeTab(t)}},n.prototype.createEntityControllers=function(){for(var e in t.wn.builder.entityControllers)"base"!=e&&(this.entityControllers[e]=new t.wn.builder.entityControllers[e](this))},n.prototype.registerHandlers=function(){for(var e in t(document).on("click","[data-builder-command]",this.proxy(this.onCommand)),t(document).on("submit","[data-builder-command]",this.proxy(this.onCommand)),this.$masterTabs.on("changed.oc.changeMonitor",this.proxy(this.onFormChanged)),this.$masterTabs.on("unchanged.oc.changeMonitor",this.proxy(this.onFormUnchanged)),this.$masterTabs.on("shown.bs.tab",this.proxy(this.onTabShown)),this.$masterTabs.on("afterAllClosed.oc.tab",this.proxy(this.onAllTabsClosed)),this.$masterTabs.on("closed.oc.tab",this.proxy(this.onTabClosed)),this.$masterTabs.on("autocompleteitems.oc.inspector",this.proxy(this.onDataRegistryItems)),this.$masterTabs.on("dropdownoptions.oc.inspector",this.proxy(this.onDataRegistryItems)),this.entityControllers)void 0!==this.entityControllers[e].registerHandlers&&this.entityControllers[e].registerHandlers()},n.prototype.hideStripeIndicator=function(){t.wn.stripeLoadIndicator.hide()},n.prototype.addMasterTab=function(t){(this.masterTabsObj.addTab(t.tabTitle,t.tab,t.tabId,"wn-"+t.tabIcon),t.isNewRecord)&&this.getMasterTabActivePane().find("form").one("ready.oc.changeMonitor",this.proxy(this.onChangeMonitorReady))},n.prototype.updateModifiedCounter=function(){var e={database:{menu:"database",count:0},models:{menu:"models",count:0},permissions:{menu:"permissions",count:0},menus:{menu:"menus",count:0},versions:{menu:"versions",count:0},localization:{menu:"localization",count:0},controller:{menu:"controllers",count:0}};t("> div.tab-content > div.tab-pane[data-modified] > form",this.$masterTabs).each((function(){var o=t(this).data("entity");e[o].count++})),t.each(e,(function(e,o){t.wn.sideNav.setCounter("builder/"+o.menu,o.count)}))},n.prototype.getSelectedPlugin=function(){var e=t("#PluginList-pluginList-plugin-list > ul > li.active");return!!e.length&&e.data("id")},n.prototype.getFormPluginCode=function(e){var o=t(e).closest("form").find('input[name="plugin_code"]').val();if(!o)throw new Error("Plugin code input is not found in the form.");return o},n.prototype.setPageTitle=function(e){t.wn.layout.setPageTitle(e.length?e+" | ":e)},n.prototype.getFileLists=function(){return t("[data-control=filelist]",this.$sidePanel)},n.prototype.dataToInspectorArray=function(t){var e=[];for(var o in t){var n={title:t[o],value:o};e.push(n)}return e},n.prototype.onCommand=function(e){if("FORM"!=e.currentTarget.tagName||"click"!=e.type){var o=t(e.currentTarget).data("builderCommand");this.triggerCommand(o,e);var n=t(e.currentTarget);if("A"!==e.currentTarget.tagName||"menuitem"!=n.attr("role")||"javascript:;"!=n.attr("href"))return e.preventDefault(),!1}},n.prototype.onFormChanged=function(e){t(".form-tabless-fields",e.target).trigger("modified.oc.tab"),this.updateModifiedCounter()},n.prototype.onFormUnchanged=function(e){t(".form-tabless-fields",e.target).trigger("unmodified.oc.tab"),this.updateModifiedCounter()},n.prototype.onTabShown=function(e){if(t(e.target).closest("[data-control=tab]").attr("id")==this.$masterTabs.attr("id")){var o=t(e.target).closest("li").attr("data-tab-id"),n=t(e.target).attr("title");n&&this.setPageTitle(n),this.getFileLists().fileList("markActive",o),t(window).trigger("resize")}},n.prototype.onAllTabsClosed=function(t){this.setPageTitle(""),this.getFileLists().fileList("markActive",null)},n.prototype.onTabClosed=function(e,o,n){t(n).find("form").off("ready.oc.changeMonitor",this.proxy(this.onChangeMonitorReady)),this.updateModifiedCounter()},n.prototype.onChangeMonitorReady=function(e){t(e.target).trigger("change")},n.prototype.onDataRegistryItems=function(e,o){var n=this;if("model-classes"==o.propertyDefinition.fillFrom||"model-forms"==o.propertyDefinition.fillFrom||"model-lists"==o.propertyDefinition.fillFrom||"controller-urls"==o.propertyDefinition.fillFrom||"model-columns"==o.propertyDefinition.fillFrom||"plugin-lists"==o.propertyDefinition.fillFrom||"permissions"==o.propertyDefinition.fillFrom){e.preventDefault();var i=null,r=o.propertyDefinition.subtypeFrom;void 0!==r&&(i=o.values[r]),t.wn.builder.dataRegistry.get(t(e.target),this.getFormPluginCode(e.target),o.propertyDefinition.fillFrom,i,(function(t){o.callback({options:n.dataToInspectorArray(t)})}))}},t(document).ready((function(){t.wn.builder.indexController=new n}))}(window.jQuery)},203:()=>{!function(t){"use strict";var e=t.wn.inspector.propertyEditors.string,o=e.prototype,n=function(t,o,n,i){this.localizationInput=null,e.call(this,t,o,n,i)};(n.prototype=Object.create(o)).constructor=e,n.prototype.dispose=function(){this.removeLocalizationInput(),o.dispose.call(this)},n.prototype.build=function(){var e=document.createElement("div"),o=document.createElement("input"),n=void 0!==this.propertyDefinition.placeholder?this.propertyDefinition.placeholder:"",i=this.inspector.getPropertyValue(this.propertyDefinition.property);o.setAttribute("type","text"),o.setAttribute("class","string-editor"),o.setAttribute("placeholder",n),e.setAttribute("class","autocomplete-container"),void 0===i&&(i=this.propertyDefinition.default),void 0===i&&(i=""),o.value=i,t.wn.foundation.element.addClass(this.containerCell,"text autocomplete"),e.appendChild(o),this.containerCell.appendChild(e),this.buildLocalizationEditor()},n.prototype.buildLocalizationEditor=function(){this.localizationInput=new t.wn.builder.localizationInput(this.getInput(),this.getForm(),{plugin:this.getPluginCode(),beforePopupShowCallback:this.proxy(this.onPopupShown,this),afterPopupHideCallback:this.proxy(this.onPopupHidden,this)})},n.prototype.removeLocalizationInput=function(){this.localizationInput.dispose(),this.localizationInput=null},n.prototype.supportsExternalParameterEditor=function(){return!1},n.prototype.registerHandlers=function(){o.registerHandlers.call(this),t(this.getInput()).on("change",this.proxy(this.onInputKeyUp))},n.prototype.unregisterHandlers=function(){o.unregisterHandlers.call(this),t(this.getInput()).off("change",this.proxy(this.onInputKeyUp))},n.prototype.getForm=function(){var e=this.getRootSurface().getInspectableElement();if(!e)throw new Error("Cannot determine inspectable element in the Builder localization editor.");return t(e).closest("form")},n.prototype.getPluginCode=function(){var t=this.getForm().find("input[name=plugin_code]");if(!t.length)throw new Error('The input "plugin_code" should be defined in the form in order to use the localization Inspector editor.');return t.val()},n.prototype.onPopupShown=function(){this.getRootSurface().popupDisplayed()},n.prototype.onPopupHidden=function(){this.getRootSurface().popupHidden()},t.wn.inspector.propertyEditors.builderLocalization=n}(window.jQuery)},38:()=>{!function(t){"use strict";void 0===t.wn.builder&&(t.wn.builder={});var e=t.wn.foundation.base,o=e.prototype,n=function o(n,i,r){this.input=n,this.form=i,this.options=t.extend({},o.DEFAULTS,r),this.disposed=!1,this.initialized=!1,this.newStringPopupMarkup=null,e.call(this),this.init()};(n.prototype=Object.create(o)).constructor=n,n.prototype.dispose=function(){this.unregisterHandlers(),this.form=null,this.options.beforePopupShowCallback=null,this.options.afterPopupHideCallback=null,this.options=null,this.disposed=!0,this.newStringPopupMarkup=null,this.initialized&&t(this.input).autocomplete("destroy"),t(this.input).removeData("localization-input"),this.input=null,o.dispose.call(this)},n.prototype.init=function(){if(!this.options.plugin)throw new Error("The options.plugin value should be set in the localization input object.");var e=t(this.input);e.data("localization-input",this),e.attr("data-builder-localization-input","true"),e.attr("data-builder-localization-plugin",this.options.plugin),this.getContainer().addClass("localization-input-container"),this.registerHandlers(),this.loadDataAndBuild()},n.prototype.buildAddLink=function(){var e=this.getContainer();if(!(e.find("a.localization-trigger").length>0)){var o=document.createElement("a");o.setAttribute("class","wn-icon-plus localization-trigger"),o.setAttribute("href","#");var n=e.position();t(o).css({top:n.top+4,right:7}),e.append(o)}},n.prototype.loadDataAndBuild=function(){this.showLoadingIndicator();var e=t.wn.builder.dataRegistry.get(this.form,this.options.plugin,"localization",null,this.proxy(this.dataLoaded)),o=this;e&&e.always((function(){o.hideLoadingIndicator()}))},n.prototype.reload=function(){t.wn.builder.dataRegistry.get(this.form,this.options.plugin,"localization",null,this.proxy(this.dataLoaded))},n.prototype.dataLoaded=function(e){if(!this.disposed){var o=t(this.input).data("autocomplete");if(o)o.source=this.preprocessData(e);else{this.hideLoadingIndicator();var n={source:this.preprocessData(e),matchWidth:!0};n=t.extend(n,this.options.autocompleteOptions),t(this.input).autocomplete(n),this.initialized=!0}}},n.prototype.preprocessData=function(e){var o=t.extend({},e);for(var n in o)o[n]=n+" - "+o[n];return o},n.prototype.getContainer=function(){return t(this.input).closest(".autocomplete-container")},n.prototype.showLoadingIndicator=function(){var t=this.getContainer();t.addClass("loading-indicator-container size-small"),t.loadIndicator()},n.prototype.hideLoadingIndicator=function(){var t=this.getContainer();t.loadIndicator("hide"),t.loadIndicator("destroy"),t.removeClass("loading-indicator-container")},n.prototype.loadAndShowPopup=function(){null===this.newStringPopupMarkup?(t.wn.stripeLoadIndicator.show(),t(this.input).request("onLanguageLoadAddStringForm").done(this.proxy(this.popupMarkupLoaded)).always((function(){t.wn.stripeLoadIndicator.hide()}))):this.showPopup()},n.prototype.popupMarkupLoaded=function(t){this.newStringPopupMarkup=t.markup,this.showPopup()},n.prototype.showPopup=function(){var e=t(this.input);e.popup({content:this.newStringPopupMarkup});var o=e.data("oc.popup").$content,n=o.find("#language_string_key");t.wn.builder.dataRegistry.get(this.form,this.options.plugin,"localization","sections",(function(t){n.autocomplete({source:t,matchWidth:!0})})),o.find("form").on("submit",this.proxy(this.onSubmitPopupForm))},n.prototype.stringCreated=function(e){if(void 0===e.localizationData||void 0===e.registryData)throw new Error("Invalid server response.");var o=t(this.input);o.val(e.localizationData.key),t.wn.builder.dataRegistry.set(this.options.plugin,"localization",null,e.registryData.strings),t.wn.builder.dataRegistry.set(this.options.plugin,"localization","sections",e.registryData.sections),o.data("oc.popup").hide(),o.trigger("change")},n.prototype.onSubmitPopupForm=function(e){var o=t(e.target);return t.wn.stripeLoadIndicator.show(),o.request("onLanguageCreateString",{data:{plugin_code:this.options.plugin}}).done(this.proxy(this.stringCreated)).always((function(){t.wn.stripeLoadIndicator.hide()})),e.preventDefault(),!1},n.prototype.onPopupHidden=function(e,o,n){t(n).find("#language_string_key").autocomplete("destroy"),t(n).find("form").on("submit",this.proxy(this.onSubmitPopupForm)),this.options.afterPopupHideCallback&&this.options.afterPopupHideCallback()},n.updatePluginInputs=function(e){for(var o=document.body.querySelectorAll('input[data-builder-localization-input][data-builder-localization-plugin="'+e+'"]'),n=o.length-1;n>=0;n--)t(o[n]).data("localization-input").reload()},n.prototype.unregisterHandlers=function(){this.input.removeEventListener("focus",this.proxy(this.onInputFocus)),this.getContainer().off("click","a.localization-trigger",this.proxy(this.onTriggerClick)),t(this.input).off("hidden.oc.popup",this.proxy(this.onPopupHidden))},n.prototype.registerHandlers=function(){this.input.addEventListener("focus",this.proxy(this.onInputFocus)),this.getContainer().on("click","a.localization-trigger",this.proxy(this.onTriggerClick)),t(this.input).on("hidden.oc.popup",this.proxy(this.onPopupHidden))},n.prototype.onInputFocus=function(){this.buildAddLink()},n.prototype.onTriggerClick=function(t){return this.options.beforePopupShowCallback&&this.options.beforePopupShowCallback(),this.loadAndShowPopup(),t.preventDefault(),!1},n.DEFAULTS={plugin:null,autocompleteOptions:{},beforePopupShowCallback:null,afterPopupHideCallback:null},t.wn.builder.localizationInput=n}(window.jQuery)},702:()=>{!function(t){"use strict";if(void 0===t.wn.table)throw new Error("The $.wn.table namespace is not defined. Make sure that the table.js script is loaded.");if(void 0===t.wn.table.processor)throw new Error("The $.wn.table.processor namespace is not defined. Make sure that the table.processor.base.js script is loaded.");var e=t.wn.table.processor.string,o=e.prototype,n=function(t,o,n){this.localizationInput=null,this.popupDisplayed=!1,e.call(this,t,o,n)};(n.prototype=Object.create(o)).constructor=n,n.prototype.dispose=function(){this.removeLocalizationInput(),o.dispose.call(this)},n.prototype.onUnfocus=function(){this.activeCell&&!this.popupDisplayed&&(this.removeLocalizationInput(),o.onUnfocus.call(this))},n.prototype.onBeforePopupShow=function(){this.popupDisplayed=!0},n.prototype.onAfterPopupHide=function(){this.popupDisplayed=!1},n.prototype.renderCell=function(t,e){o.renderCell.call(this,t,e)},n.prototype.buildEditor=function(e,n,i){o.buildEditor.call(this,e,n,i),t.wn.foundation.element.addClass(n,"autocomplete-container"),this.buildLocalizationEditor()},n.prototype.buildLocalizationEditor=function(){var e=this.getInput();this.localizationInput=new t.wn.builder.localizationInput(e,t(e),{plugin:this.getPluginCode(e),beforePopupShowCallback:t.proxy(this.onBeforePopupShow,this),afterPopupHideCallback:t.proxy(this.onAfterPopupHide,this),autocompleteOptions:{menu:'<ul class="autocomplete dropdown-menu table-widget-autocomplete localization"></ul>',bodyContainer:!0}})},n.prototype.getInput=function(){return this.activeCell?this.activeCell.querySelector(".string-input"):null},n.prototype.getPluginCode=function(e){var o=t(e).closest("form").find("input[name=plugin_code]");if(!o.length)throw new Error('The input "plugin_code" should be defined in the form in order to use the localization table processor.');return o.val()},n.prototype.removeLocalizationInput=function(){this.localizationInput&&(this.localizationInput.dispose(),this.localizationInput=null)},t.wn.table.processor.builderLocalization=n}(window.jQuery)}},t=>{var e;e=13,t(t.s=e)}]);